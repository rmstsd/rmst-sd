<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>sd</title>

    <style></style>
  </head>

  <body>
    <script>
      const previewFloors = [
        {
          enabled: true,
          areaName: 'Area-3',
          floorOrder: 4,
          code: '434',
          areaId: 3,
          switchMapPoints: [
            {
              pointName: 'SM100'
            },
            {
              pointName: 'LM500'
            },
            {
              pointName: 'LM507'
            }
          ],
          waitPointNames: []
        },
        {
          enabled: true,
          areaName: 'Area-4',
          floorOrder: 2,
          code: '334',
          areaId: 4,
          switchMapPoints: [
            {
              pointName: 'AP2021'
            }
          ],
          waitPointNames: []
        },
        {
          enabled: true,
          areaName: 'F1',
          floorOrder: 1,
          code: 'd',
          areaId: 1,
          switchMapPoints: [
            {
              pointName: 'SM100'
            }
          ],
          waitPointNames: []
        },
        {
          enabled: true,
          areaName: 'F2',
          floorOrder: 0,
          code: '556',
          areaId: 2,
          switchMapPoints: [
            {
              pointName: 'SM100',
              pointName: 'LM500'
            }
          ],
          waitPointNames: []
        }
      ]

      let a = [1, null, 1, 1, 1, null, 1]

      console.log(previewFloors)

      function getAns() {
        const points = Array.from(
          new Set(previewFloors.map(item => item.switchMapPoints.map(point => point.pointName)).flat(Infinity))
        )
        const ans = points.map(item => {
          const ansList = []

          let prevFloor
          let prevIndex = -1

          for (let index = 0; index < previewFloors.length; index++) {
            const fItem = previewFloors[index]
            const same = fItem.switchMapPoints.some(p => p.pointName === item)

            if (same) {
              if (!prevFloor) {
                prevFloor = fItem
                prevIndex = index
              } else {
                ansList.push({ pointName: item, start: prevFloor, end: fItem, span: index - prevIndex })

                prevFloor = fItem
                prevIndex = index
              }
            }
          }

          return ansList
        })

        return ans
      }

      const ans = getAns(previewFloors)
      console.log(ans)
    </script>
  </body>
</html>
