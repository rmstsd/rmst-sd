<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>aaa</title>

    <style></style>
  </head>

  <body>
    <script>
      const data = [
        { id: 1, name: 'John', age: 8 },
        { id: 10, name: 'aa', age: 11 },
        { id: 9, name: 'bb', age: 13 },
        { id: 3, name: 'aa', age: 55 },
        { id: 8, name: 'dd', age: 13 },
        { id: 5, name: 'ee', age: 20 },
        { id: 4, name: 'John', age: 30 }
      ]

      const ans = query(data)
        .where(item => item.age > 0)
        .sortBy('id')
        .groupBy('name')
        .execute()

      console.log(ans)

      function query(data) {
        class Q {
          constructor() {
            this.arrayData = data
          }

          arrayData = []

          tasks = []

          where(filterFunc) {
            const whereTask = () => {
              console.log('whereTask')
              this.arrayData = this.arrayData.filter(filterFunc)
            }
            this.tasks.push(whereTask)

            return this
          }

          sortBy(sortKey) {
            const sortByTask = () => {
              console.log('sortByTask')
              this.arrayData = this.arrayData.sort((a, b) => a[sortKey] - b[sortKey])
            }
            this.tasks.push(sortByTask)

            return this
          }

          groupBy(groupKey) {
            const groupByTask = () => {
              console.log('groupByTask')
              const keys = new Set(this.arrayData.map(item => item[groupKey]))
              const ans = []
              for (const key of keys) {
                ans.push(this.arrayData.filter(item => item[groupKey] === key))
              }
              this.arrayData = ans
            }
            this.tasks.push(groupByTask)

            return this
          }

          execute() {
            this.tasks.forEach(taskItem => taskItem())

            return this.arrayData
          }
        }

        return new Q(data)
      }
    </script>
  </body>
</html>
